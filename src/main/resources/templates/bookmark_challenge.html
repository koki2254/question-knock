<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>è‹¦æ‰‹å¯¾ç­–ãƒ¢ãƒ¼ãƒ‰</title>
<style th:replace="header :: style"></style>

<style>
    body { font-family: "Segoe UI", sans-serif; background: #f5f5f5; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    .main-wrapper { display: flex; flex: 1; height: 100%; overflow: hidden; }
    .quiz-area { flex: 2; padding: 20px; overflow-y: auto; }
    .quiz-container { max-width: 800px; background: #fff; margin: 0 auto; padding: 25px; border-radius: 10px; }
    
    /* è³ªå•ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆçœç•¥æ™‚ã¯ challenge.html ã¨åŒã˜ã‚‚ã®ã‚’é©ç”¨ã—ã¦ãã ã•ã„ï¼‰ */
    .ai-area { flex: 1; background: #fff; border-left: 1px solid #ddd; display: flex; flex-direction: column; padding: 10px; }
    
    .question-box { display: none; } .question-box.active { display: block; }
    .choice-btn { display: block; width: 100%; padding: 10px; margin: 5px 0; text-align: left; background: #f9f9f9; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; }
    .choice-btn:hover { background: #eef; }
    .correct-answer { background: #d4edda; border-color: #28a745; }
    .wrong-answer { background: #f8d7da; border-color: #dc3545; }
    
    .btn-bookmark { border: none; background: none; font-size: 1.5rem; cursor: pointer; color: #ffd700; } /* æœ€åˆã‹ã‚‰é‡‘è‰² */
</style>
</head>
<body>

<div th:replace="header :: part"></div>

<div class="main-wrapper">
    <div class="quiz-area">
        <div class="quiz-container">
            <h2>ğŸ”¥ è‹¦æ‰‹å…‹æœãƒ¢ãƒ¼ãƒ‰</h2>
            
            <form id="quizForm" th:action="@{/challenge/submit}" method="post">
                <div th:each="q, iterStat : ${questions}" 
                     th:id="'q-container-' + ${iterStat.index}" 
                     class="question-box" 
                     th:classappend="${iterStat.index == 0} ? ' active' : ''">

                    <div style="text-align: right;">
                        <button type="button" class="btn-bookmark" 
                                th:onclick="|toggleBookmark(${q.questionId}, this)|"
                                title="ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’è§£é™¤">â˜…</button>
                    </div>

                    <h3 th:text="'å• ' + (${iterStat.index} + 1)"></h3>
                    <p th:text="${q.questionText}"></p>
                    <img th:if="${q.imageUrl}" th:src="@{${q.imageUrl}}" style="max-width:100%">

                    <div class="choices">
                        <div th:each="choice : ${q.choices}">
                            <button type="button" class="choice-btn"
                                    th:onclick="|checkAnswer(this, ${choice.isCorrect})|">
                                <span th:text="${choice.choiceText}"></span>
                            </button>
                        </div>
                    </div>

                    <div class="navigation" style="margin-top:20px; text-align:right;">
                        <button type="button" th:onclick="'nextQuestion(' + ${iterStat.index} + ')'">æ¬¡ã¸</button>
                    </div>
                </div>
                <button type="submit" id="finalSubmit" style="display:none;">çµæœã‚’è¦‹ã‚‹</button>
            </form>
        </div>
    </div>
    
    <div class="ai-area">
        <p>AIå…ˆç”Ÿã‚¨ãƒªã‚¢</p>
    </div>
</div>

<script>
    // ç°¡æ˜“çš„ãªåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    function nextQuestion(index) {
        document.getElementById('q-container-' + index).classList.remove('active');
        const next = document.getElementById('q-container-' + (index + 1));
        if (next) {
            next.classList.add('active');
        } else {
            // æœ€å¾Œã®å•é¡Œãªã‚‰é€ä¿¡ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºãªã©ã®å‡¦ç†
            document.getElementById('finalSubmit').style.display = 'block';
            document.getElementById('finalSubmit').click();
        }
    }

    function checkAnswer(btn, isCorrect) {
        if(isCorrect) {
            btn.style.backgroundColor = "#d4edda";
            alert("æ­£è§£ï¼");
        } else {
            btn.style.backgroundColor = "#f8d7da";
            alert("ä¸æ­£è§£...");
        }
    }

    function toggleBookmark(qid, btn) {
        fetch('/api/bookmark/toggle?questionId=' + qid, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if(data.status === 'removed') {
                btn.style.color = '#ccc'; // ç°è‰²ã«
            } else {
                btn.style.color = '#ffd700'; // é‡‘è‰²ã«
            }
        });
    }
</script>
</body>
</html>